<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- <meta http-equiv="Content-Security-Policy" content="font-src 'self' data:; img-src 'self' data:; default-src 'self' http://121.0.0:3000/" -->
  <link rel="stylesheet" href="./style.css" type="text/html">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
  crossorigin=""/>

<style>

#mapid { height: 250px; }

</style>
  <title>Document</title>
  </head>
  <body>





    <h1>Geolocation</h1>

    <p>
      latitude: <span id="latitude"></span>&deg;</br>
      longitude: <span id="longitude"></span>&deg;</br>
    </p>

     <div id="mapid"></div>

     <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
       integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
       crossorigin="">
     </script>
     <script>
        var mymap;
        if ("geolocation" in navigator) {
          console.log('geolocation is available');
          navigator.geolocation.getCurrentPosition(async position => { //making the position callback an asyncrhonous function
            console.log(position);
            const lat = position.coords.latitude;
            const long = position.coords.longitude;
            document.getElementById('latitude').textContent = lat;
            document.getElementById('longitude').textContent = long;


            mymap = L.map('mapid').setView([lat, long], 13);
            var marker = L.marker([lat, long]).addTo(mymap); /*adding markers of my location to the code
            even though I still have to fix where the maps location is since by default its Long*/
            marker.bindPopup("<b>Found You!</b><br>I am your location.").openPopup();
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={myAccessToken}', {
              attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
              maxZoom: 18,
              id: 'mapbox/streets-v11',
              tileSize: 512,
              zoomOffset: -1,
              myAccessToken: 'pk.eyJ1IjoiYmFiNjE5IiwiYSI6ImNrN2kwN2ZudTBmcWwzZW84ZHRtZDQzNXcifQ.LhhtDEYetalJbQ8KkdEyjA'
            }).addTo(mymap);

          }); //end of position function


        } else {
          console.log('geolocation IS NOT available');
        }


     </script>

     <br>
      <button id="console" onclick="sendConsoleInfo()">Share Your Location!</button>
              <script>
                function sendConsoleInfo() {
                  alert('THANKS FOR SENDING YOUR LOCATION!');

                   if ("geolocation" in navigator) {
                     console.log('geolocation is available');
                     navigator.geolocation.getCurrentPosition(async position => { //making the position callback an asyncrhonous function
                       console.log(position);
                       const lat = position.coords.latitude;
                       const long = position.coords.longitude;
                       document.getElementById('latitude').textContent = lat;
                       document.getElementById('longitude').textContent = long;

                       const data = {lat,long};/*sending the lat and long as soon as its ready inside of an object*/
                       const options = {
                         //first property we need to put in options is teh (method) that we are using
                         method: 'POST',
                         headers: {
                           'Content-Type': 'application/json'
                           //'Content-Type': 'application/x-www-form-urlencoded',
                         },
                         body: JSON.stringify(data)

                         /*
                         specifically sending data in JSON format. we need to specify this in something called
                         a header.

                         - a header is something that can be packaged along with any POST or GET request thats moving between
                           client and server, and its a way of adding some additional meta information. Can read more in the mozzilla
                           docs

                         - Headers have a name, a colon, and a value

                         * so we get the geolocation data, we package it into a post, and we send it to the endpoint.
                         */

                       };

                       // document.getElementById("console") => {
                       //
                       // }
                       const response = await fetch('/sending_data',options);

                       //const json_information =  await response.json();
                       const json_information =  await response.json();


                       // async function consoleInfo(){
                       //   //Now an async function
                       //   const response = await fetch('/sending_data',options);
                       //   const json_information =  await response.json();
                       //   console.log(json_information);
                       // }
                       /*
                       .then(response => {
                         console.log(response);
                       });

                       previous code that was added before position in the code above was changed to an asynchronous function, and the keyword
                       await was used
                       */

                        /*
                       right now what we want to do is send a post.
                       since we are not doing a regular fetch request, we have to provide a second argument which we named options, which is just a javaScript object.
                       we create the javaScript object options so we can evaluate it seperately.

                       fetch() returns a promise

                       when the response comes back, its written as a datastream, and its up to us to specify how we want to read the information
                       - we want to read it as a JSON. So we have to handle this in the client index.html
                         - to do this we could add on another .then() to the fetch function but Dan Shiffman suggest to go to the
                           navigator.geolocation.getCurrentPosition(position => {}) and make the callback function position an asyncrhonous function
                           with the async keyword, and then we could use the keyword await
                       */


                     }); //end of position function


                   } else {
                     console.log('geolocation IS NOT available');
                   }



                }

                // document.addEventListener('DOMContentLoaded', function () {
                //   document.getElementById('console')
                //     .addEventListener('click', sendConsoleInfo);
                // });
                </script>





    <!-- <script>


     </script> -->


  </body>
</html>
